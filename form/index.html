<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Share Your Invite</title>
</head>
<body>
    <h1>Share with Friends</h1>

    <p id="user-link"></p>
    <input type="text" id="name" placeholder="Enter your name">
    <input type="email" id="friend-email-1" placeholder="Friend's Email 1">
    <input type="email" id="friend-email-2" placeholder="Friend's Email 2">
    <input type="email" id="friend-email-3" placeholder="Friend's Email 3">

    <button id="generate-preview">Generate Preview</button>

    <h3>Preview Message:</h3>
    <textarea id="preview-message" readonly></textarea>

    <h2>Share Options</h2>
    <a id="sms-button" href="#">Share via SMS</a>
    <a id="email-button" href="#">Share via Email</a>
    <a id="whatsapp-button" href="#">Share via WhatsApp</a>
    <a id="facebook-button" href="#">Share via Facebook</a>

    <button id="stats-button">View Stats</button>

    <!-- Add Reset Button -->
    <button id="reset-button">Reset Fingerprint</button>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const userId = generateFingerprint();
            const userUrl = localStorage.getItem('userUrl_' + userId);

            // If no URL is found, redirect to the landing page (index.html)
            if (!userUrl) {
                // Check if there are available URLs left
                if (localStorage.getItem('urlIndex') === null) {
                    window.location.href = "index.html"; // Redirect if no URLs available
                } else {
                    assignUrlToUser(userId); // Assign a new URL if this is a new user
                }
            } else {
                // If the user has a URL assigned, display it and allow sharing
                document.getElementById('user-link').textContent = userUrl;
            }

            // Generate preview for the share buttons
            document.getElementById("generate-preview").addEventListener("click", () => {
                const name = document.getElementById("name").value;
                const urlWithName = `${userUrl}?name=${encodeURIComponent(name)}`;
                document.getElementById("preview-message").value = `Hi, ${name} has invited you to check this out: ${urlWithName}`;

                // Set share links
                document.getElementById("sms-button").href = `sms:?body=${encodeURIComponent(previewMessage)}`;
                document.getElementById("email-button").href = `mailto:?subject=Join us&body=${encodeURIComponent(previewMessage)}`;
                document.getElementById("whatsapp-button").href = `https://wa.me/?text=${encodeURIComponent(previewMessage)}`;
                document.getElementById("facebook-button").href = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(urlWithName)}`;
            });

            // Reset Fingerprint functionality
            document.getElementById("reset-button").addEventListener("click", () => {
                resetFingerprint();
                alert("Fingerprint and URL data have been reset!");
                window.location.href = "index.html"; // Redirect to the landing page after reset
            });
        });

        // Function to generate a unique fingerprint
        function generateFingerprint() {
            const fingerprintData = [
                navigator.userAgent,  // User agent string
                screen.width,         // Screen width
                screen.height,        // Screen height
                navigator.language,   // User's language
                new Date().getTime()   // Current timestamp
            ].join('|');

            // Hash the fingerprint data to create a more unique ID
            return hashString(fingerprintData);
        }

        // A simple hashing function to generate a unique ID
        function hashString(str) {
            let hash = 0;
            for (let i = 0; i < str.length; i++) {
                const char = str.charCodeAt(i);
                hash = (hash << 5) - hash + char;
                hash &= hash; // Convert to 32bit integer
            }
            return hash.toString();
        }

        // Assign URL to the user if not already assigned
        function assignUrlToUser(userId) {
            const urls = [
                "https://example.com/url1",
                "https://example.com/url2",
                "https://example.com/url3"
            ];

            // Get the current URL index or start from 0
            let currentIndex = localStorage.getItem('urlIndex');
            if (!currentIndex) {
                currentIndex = 0;
            }

            // Assign the URL to the user and increment the index
            localStorage.setItem('userUrl_' + userId, urls[currentIndex]);
            localStorage.setItem('urlIndex', parseInt(currentIndex) + 1); // Increment URL index

            // Redirect to this page again so the user can see their assigned URL
            window.location.reload();
        }

        // Reset Fingerprint function
        function resetFingerprint() {
            const userId = generateFingerprint();
            // Remove the stored fingerprint-related data from localStorage
            localStorage.removeItem('userUrl_' + userId);
            localStorage.removeItem('assignedUrlIndex_' + userId);
            localStorage.removeItem('userEmail_' + userId);
            localStorage.removeItem('urlIndex'); // Reset the URL index
        }
    </script>
</body>
</html>
