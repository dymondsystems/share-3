<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Share Your Invite</title>
    <style>
        input, button, textarea {
            margin-bottom: 10px;
            padding: 8px;
            width: 300px;
        }
    </style>
</head>
<body>
    <h1>Your Unique Share Link</h1>

    <form id="share-form">
        <label for="name">Your Name:</label><br>
        <input type="text" id="name" placeholder="Enter your name" required><br>

        <label for="email1">Friend 1 Email:</label><br>
        <input type="email" id="email1" placeholder="Friend 1 Email" required><br>

        <label for="email2">Friend 2 Email:</label><br>
        <input type="email" id="email2" placeholder="Friend 2 Email"><br>

        <label for="email3">Friend 3 Email:</label><br>
        <input type="email" id="email3" placeholder="Friend 3 Email"><br>

        <button type="button" id="generate-preview">Generate Preview</button>
    </form>

    <h2>Preview:</h2>
    <textarea id="message-preview" rows="4" cols="50" readonly></textarea><br>

    <h2>Your Link Only:</h2>
    <textarea id="link-only" rows="2" cols="50" readonly></textarea><br>

    <h2>Share Your Invite:</h2>
    <a id="sms-button" href="#">Share via SMS</a><br>
    <a id="email-button" href="#">Share via Email</a><br>
    <a id="whatsapp-button" href="#">Share via WhatsApp</a><br>
    <a id="facebook-button" href="#">Share via Facebook</a><br>
    
    <h2>Stats:</h2>
    <a id="stats-button" href="#">View Stats</a><br>

    <script>
        // Array of pre-defined URLs
        const urls = [
            "https://example.com/url1",
            "https://example.com/url2",
            "https://example.com/url3"
        ];

        // Get the user's email from localStorage
        const userEmail = localStorage.getItem('userEmail');

        if (!userEmail) {
            // If no email is found, redirect to the landing page
            window.location.href = 'index.html';
        }

        // Assign a unique URL to the user
        let assignedUrlIndex = localStorage.getItem('assignedUrlIndex');

        if (!assignedUrlIndex) {
            // If no URL assigned, assign the first URL from the list
            assignedUrlIndex = 0;
            localStorage.setItem('assignedUrlIndex', assignedUrlIndex);
        }

        // Get the URL assigned to this user
        const assignedUrl = urls[assignedUrlIndex];

        // Define the generate preview button functionality
        document.getElementById('generate-preview').addEventListener('click', function() {
            const name = document.getElementById('name').value;
            const email1 = document.getElementById('email1').value;
            const email2 = document.getElementById('email2').value;
            const email3 = document.getElementById('email3').value;

            // Append the user's name to the URL
            const userLink = `${assignedUrl}?name=${encodeURIComponent(name)}`;

            // Create the preview message
            const previewMessage = `Hi! Join me at ${userLink}\n\nFriend 1: ${email1}\nFriend 2: ${email2}\nFriend 3: ${email3}`;

            // Display the preview message
            document.getElementById('message-preview').value = previewMessage;

            // Display just the URL in the link-only textarea
            document.getElementById('link-only').value = userLink;

            // Setup the share buttons with the link
            const smsMessage = `sms:?body=${encodeURIComponent(previewMessage)}`;
            const emailMessage = `mailto:?subject=Join Us&body=${encodeURIComponent(previewMessage)}`;
            const whatsappMessage = `https://wa.me/?text=${encodeURIComponent(previewMessage)}`;
            const facebookMessage = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(userLink)}`;

            // Set up the share buttons
            document.getElementById('sms-button').href = smsMessage;
            document.getElementById('email-button').href = emailMessage;
            document.getElementById('whatsapp-button').href = whatsappMessage;
            document.getElementById('facebook-button').href = facebookMessage;

            // Set up the stats link
            document.getElementById('stats-button').href = userLink + ".stats";
        });
    </script>
</body>
</html>
