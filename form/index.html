<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sharing Page</title>
</head>
<body>
    <h1>Share the Beta Access</h1>

    <form id="email-form">
        <label for="name">Your Name:</label><br>
        <input type="text" id="name" placeholder="Enter your name" required><br>
        <label for="friend1">Friend's Email 1:</label><br>
        <input type="email" id="friend1" placeholder="Friend's Email 1" required><br>
        <label for="friend2">Friend's Email 2:</label><br>
        <input type="email" id="friend2" placeholder="Friend's Email 2" required><br>
        <label for="friend3">Friend's Email 3:</label><br>
        <input type="email" id="friend3" placeholder="Friend's Email 3" required><br>
        <button type="button" id="generate-button">Generate Preview</button>
    </form>

    <h2>Preview Message</h2>
    <textarea id="preview-message" rows="5" cols="50" readonly></textarea>
    <h2>Your Link</h2>
    <textarea id="link-only" rows="1" cols="50" readonly></textarea>
    <button id="stats-button">View Stats</button>

    <script>
        function getCookie(name) {
            const value = `; ${document.cookie}`;
            const parts = value.split(`; ${name}=`);
            if (parts.length === 2) return parts.pop().split(";").shift();
        }

        const fingerprint = getCookie("fingerprint");
        const assignedUrl = localStorage.getItem(`url_${fingerprint}`);

        if (!fingerprint || !assignedUrl) {
            window.location.href = "signup.html";
        }

        document.getElementById("generate-button").addEventListener("click", () => {
            const name = document.getElementById("name").value;
            const friend1 = document.getElementById("friend1").value;
            const friend2 = document.getElementById("friend2").value;
            const friend3 = document.getElementById("friend3").value;

            if (!name || !friend1 || !friend2 || !friend3) {
                alert("Please fill in all fields.");
                return;
            }

            const urlWithName = `${assignedUrl}?name=${encodeURIComponent(name)}`;
            const statsUrl = `${assignedUrl}.stats`;

            const message = `Hey! I've joined this amazing beta access program. You can join too! Use my referral link: ${urlWithName}`;
            const mailtoMessage = `mailto:${friend1},${friend2},${friend3}?subject=Join the Beta Program&body=${encodeURIComponent(
                message
            )}`;

            document.getElementById("preview-message").value = message;
            document.getElementById("link-only").value = urlWithName;

            // Generate share buttons
            document.getElementById("stats-button").onclick = () => {
                window.location.href = statsUrl;
            };
        });
    </script>
</body>
</html>
