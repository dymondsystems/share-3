<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign Up</title>
    <script src="https://cdn.jsdelivr.net/npm/@fingerprintjs/fingerprintjs@3/dist/fp.min.js"></script>
</head>
<body>
    <h1>Sign Up for Early Access</h1>
    <form id="signup-form">
        <label for="email">Enter your email:</label>
        <input type="email" id="email" required placeholder="Your Email">
        <button type="submit">Sign Up</button>
    </form>

    <script>
        // Example URL list
        const urls = ["url1", "url2", "url3", "url4"];

        // Generate a fingerprint using FingerprintJS
        async function generateFingerprint() {
            console.log("Generating fingerprint...");
            const fp = await FingerprintJS.load(); // Initialize the FingerprintJS library
            const result = await fp.get(); // Get the fingerprint
            console.log("Fingerprint generated:", result.visitorId); // Log the unique visitor ID
            return result.visitorId; // Return the unique ID
        }

        // Function to assign a URL based on the fingerprint
        async function assignUrl() {
            const fingerprint = await generateFingerprint();

            console.log("Assigning URL for fingerprint:", fingerprint);

            // Simple hash-based index for selecting URL
            const urlIndex = parseInt(fingerprint.substr(0, 8), 16) % urls.length;
            const assignedUrl = urls[urlIndex];

            console.log("Assigned URL:", assignedUrl);

            // Store in localStorage
            localStorage.setItem("userFingerprint", fingerprint);
            localStorage.setItem("userUrl", assignedUrl);

            // Redirect the user
            window.location.href = "/share-3/form/"; // Modify as needed
        }

        // Form submission handling
        async function handleSignup(event) {
            event.preventDefault(); // Stop the form from reloading the page
            console.log("Signup button clicked!");

            const emailInput = document.getElementById("email");
            const email = emailInput.value;

            if (!email) {
                alert("Please enter a valid email address.");
                console.log("No email entered.");
                return;
            }

            console.log("Email entered:", email);

            // Check if the user already signed up
            const existingFingerprint = localStorage.getItem("userFingerprint");
            if (existingFingerprint) {
                console.log("Returning user detected, redirecting...");
                window.location.href = "dashboard.html"; // Modify as needed
            } else {
                console.log("New user detected, generating fingerprint...");
                await assignUrl(); // Generate fingerprint and assign URL
            }
        }

        // Attach event listener to the signup form
        document.addEventListener("DOMContentLoaded", () => {
            console.log("Page loaded, attaching event listener...");
            const signupForm = document.getElementById("signup-form");

            if (signupForm) {
                signupForm.addEventListener("submit", handleSignup);
                console.log("Event listener attached to form.");
            } else {
                console.error("Signup form not found!");
            }
        });
    </script>
</body>
</html>
