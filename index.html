<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign Up</title>
</head>
<body>
    <h1>Sign Up for Beta Access</h1>
    <form id="signup-form">
        <label for="email">Enter your email:</label><br>
        <input type="email" id="email" required><br>
        <button type="button" id="signup-button">Sign Up</button>
    </form>

    <script>
        const urls = [
            "https://example.com/url1",
            "https://example.com/url2",
            "https://example.com/url3"
        ];

        const cookieExpiryHours = 48;

        function generateFingerprint() {
            return (
                navigator.userAgent +
                screen.width +
                screen.height +
                navigator.language
            );
        }

        function setCookie(name, value, hours) {
            const d = new Date();
            d.setTime(d.getTime() + hours * 60 * 60 * 1000);
            document.cookie = `${name}=${value}; expires=${d.toUTCString()}; path=/`;
        }

        function getCookie(name) {
            const value = `; ${document.cookie}`;
            const parts = value.split(`; ${name}=`);
            if (parts.length === 2) return parts.pop().split(";").shift();
        }

        document.getElementById("signup-button").addEventListener("click", () => {
            const email = document.getElementById("email").value;
            if (!email) {
                alert("Please enter a valid email.");
                return;
            }

            const fingerprint = generateFingerprint();
            let assignedUrl = localStorage.getItem(`url_${fingerprint}`);

            // Redirect returning user
            if (assignedUrl) {
                window.location.href = "sharing.html";
                return;
            }

            // Get the next available URL
            let assignedUrlIndex = parseInt(localStorage.getItem("urlIndex")) || 0;
            if (assignedUrlIndex >= urls.length) {
                alert("No more URLs available.");
                window.location.href = "/dashboard.html"; // Redirect to dashboard if URLs are exhausted
                return;
            }

            assignedUrl = urls[assignedUrlIndex];
            localStorage.setItem(`url_${fingerprint}`, assignedUrl);
            localStorage.setItem("urlIndex", assignedUrlIndex + 1);

            // Store email and set cookie
            localStorage.setItem("email", email);
            setCookie("fingerprint", fingerprint, cookieExpiryHours);

            window.location.href = "sharing.html";
        });

        // Redirect if user already signed in
        const fingerprint = getCookie("fingerprint");
        if (fingerprint && localStorage.getItem(`url_${fingerprint}`)) {
            window.location.href = "sharing.html";
        }
    </script>
</body>
</html>
